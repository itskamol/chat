# Media Server

This service is responsible for handling real-time media streaming using Mediasoup.

## Development

### Prerequisites
- Node.js (v18 or later recommended)
- Docker (optional, for containerized deployment)

### Setup
1. **Clone the repository (or ensure this directory is part of the main project).**
2. **Navigate to the `media-service` directory:**
   ```bash
   cd media-service
   ```
3. **Install dependencies:**
   ```bash
   npm install
   ```

### Running the Server
1. **Compile TypeScript:**
   ```bash
   npm run build 
   ```
   (You'll need to add a `build` script to `package.json`, e.g., `"build": "tsc"`)

2. **Run the server:**
   ```bash
   npm start
   ```
   (You'll need to add a `start` script to `package.json`, e.g., `"start": "node dist/app.js"`)

   The server will typically start on port 3001 (or as configured by environment variables).

### Environment Variables
The following environment variables can be used to configure the server:

- `PORT`: The port on which the Express server will listen (default: 3001).
- `MEDIASOUP_LISTEN_IP`: The IP address Mediasoup will listen on (default: '0.0.0.0').
- `MEDIASOUP_ANNOUNCED_IP`: The public IP address to be announced by Mediasoup (attempts to auto-detect, can be manually set).
- `MEDIASOUP_RTC_MIN_PORT`: Minimum port for Mediasoup RTC (default: 40000).
- `MEDIASOUP_RTC_MAX_PORT`: Maximum port for Mediasoup RTC (default: 49999).

### Health Check
A health check endpoint is available at `/health`.

## Docker

To build and run the service using Docker:

1. **Build the Docker image:**
   ```bash
   docker build -t media-service .
   ```
2. **Run the Docker container:**
   ```bash
   docker run -p 3001:3001 --env-file .env media-service 
   ```
   (Ensure you have a `.env` file with necessary environment variables if you are not using defaults, or pass them with `-e` flags).

   Example of a minimal `.env` file:
   ```
   PORT=3001
   # MEDIASOUP_ANNOUNCED_IP=your_public_ip_here # Important for non-local deployments
   ```

## Project Structure
- `src/`: Contains the TypeScript source code.
  - `app.ts`: Main application entry point, Express server, and Mediasoup initialization.
  - `config.ts`: Configuration for the server and Mediasoup.
- `dist/`: Contains the compiled JavaScript code (generated by `tsc`).
- `Dockerfile`: For building the Docker image.
- `.dockerignore`: Specifies files to ignore when building the Docker image.
- `tsconfig.json`: TypeScript compiler options.
- `package.json`: Node.js project metadata and dependencies.
